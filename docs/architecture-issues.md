# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–µ–∫—Ç–∞ Recombinator

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-11-22
**–í–µ—Ä—Å–∏—è:** –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã

---

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

–ü—Ä–æ–µ–∫—Ç Recombinator –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **—Å–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏** —Å —Ö–æ—Ä–æ—à–æ –ø—Ä–æ–¥—É–º–∞–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏ (–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –º–µ—Ç—Ä–∏–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, —Ç—Ä–µ—Ö—Ñ–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞). –û–¥–Ω–∞–∫–æ –∏–º–µ–µ—Ç **—Å–µ—Ä—å–µ–∑–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã** –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

**–í—ã—è–≤–ª–µ–Ω–æ:** 47 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ 8 –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥:** –í—ã—Å–æ–∫–∏–π (7/10)
**–°—Ç–∞—Ç—É—Å:** –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è production

---

## 1. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1.1 –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–ü–∞—Ç—Ç–µ—Ä–Ω:** Visitor Pattern + –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä

```
src/
‚îú‚îÄ‚îÄ Visitor/           # 18 visitor –∫–ª–∞—Å—Å–æ–≤
‚îî‚îÄ‚îÄ *.php             # 31 –∫–ª–∞—Å—Å –≤ –∫–æ—Ä–Ω–µ (–ø–ª–æ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
```

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 1.1: –ü–ª–æ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í—Å–µ 31 –∫–ª–∞—Å—Å –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ–≤–æ–º namespace `Recombinator\` –±–µ–∑ –ª–æ–≥–∏—á–µ—Å–∫–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

**–í–ª–∏—è–Ω–∏–µ:**
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏ (unfold/fold/interactive)
- –ù–µ—Ç —á–µ—Ç–∫–∏—Ö –≥—Ä–∞–Ω–∏—Ü –º–æ–¥—É–ª–µ–π
- –°–ª–æ–∂–Ω–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```
src/
‚îú‚îÄ‚îÄ Core/              # Parser, Fluent, ExecutionCache
‚îú‚îÄ‚îÄ Analysis/          # –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ Transformation/    # Visitors, Separator, Recovery
‚îú‚îÄ‚îÄ Interactive/       # CLI, EditSession, ChangeHistory
‚îî‚îÄ‚îÄ Domain/            # Value objects (SideEffectType, ComplexityMetrics)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

## 2. –°–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–ª–∞—Å—Å–æ–≤

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 2.1: Parser - –ø–∞—Ç—Ç–µ—Ä–Ω "God Object"

**–§–∞–π–ª:** `src/Parser.php` (—Å—Ç—Ä–æ–∫–∏ 29-279)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ü—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ 9+ visitor –∫–ª–∞—Å—Å–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 89-99)
- –°–º–µ—à–∏–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: file I/O, –ø–∞—Ä—Å–∏–Ω–≥ AST, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è visitor'–æ–≤, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- 11 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å visitors –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

```php
// –°—Ç—Ä–æ–∫–∏ 89-99: –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
$this->visitors = [
    new BinaryAndIssetVisitor(),
    new RemoveVisitor(),
    new ConcatAssertVisitor(),
    // ... –µ—â–µ 6 visitor'–æ–≤
];
```

**–í–ª–∏—è–Ω–∏–µ:** –ù–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø Open/Closed, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–≤–µ–π–µ—Ä

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 7 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤:
- `FileReader` - —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- `ASTParser` - –ø–∞—Ä—Å–∏–Ω–≥ –≤ AST
- `VisitorPipeline` - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è visitor'–æ–≤
- `CodePrinter` - –≤—ã–≤–æ–¥ –∫–æ–¥–∞
- `DiffGenerator` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è diff
- `CacheManager` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º
- `ParserFacade` - —Ñ–∞—Å–∞–¥ –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ API

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 2.2: –†–∏—Å–∫ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–§–∞–π–ª—ã:**
- `src/SideEffectSeparator.php`
- `src/EffectDependencyGraph.php`
- `src/PureBlockFinder.php`

**–ü–∞—Ç—Ç–µ—Ä–Ω:** –ö–ª–∞—Å—Å—ã —Å–æ–∑–¥–∞—é—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –¥—Ä—É–≥ –¥—Ä—É–≥–∞ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π dependency injection

```php
// SideEffectSeparator.php —Å—Ç—Ä–æ–∫–∏ 53-61
public function __construct(
    ?EffectDependencyGraph $dependencyGraph = null,
    ?PureBlockFinder $pureBlockFinder = null,
) {
    $this->dependencyGraph = $dependencyGraph ?? new EffectDependencyGraph();
    $this->pureBlockFinder = $pureBlockFinder ?? new PureBlockFinder();
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°–∫—Ä—ã—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –£—Å–ª–æ–∂–Ω—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–æ–∑–¥–∞–µ—Ç –Ω–µ—è–≤–Ω—É—é —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —É–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 2.3: ScopeStore - –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–§–∞–π–ª:** `src/ScopeStore.php`

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ò–∑–º–µ–Ω—è–µ–º–æ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–µ –º–µ–∂–¥—É visitors
- –ü—É–±–ª–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É scope
- –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏

```php
// –°—Ç—Ä–æ–∫–∏ 25-31: –ü—É–±–ª–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω—è–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
public array $global = [];
public array $scopes = [];
public ?string $currentScope = null;
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –°–¥–µ–ª–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É scope
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å immutable design

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

## 3. –ù–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ SOLID

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 3.1: –ù–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle (SRP)

#### –ü—Ä–æ–±–ª–µ–º–∞ 3.1.1: Parser - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

**–§–∞–π–ª:** `src/Parser.php`

**–í—ã—è–≤–ª–µ–Ω–æ 7 –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π:**
1. –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (buildScopes, updateCache)
2. –ü–∞—Ä—Å–∏–Ω–≥ AST (buildAST)
3. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è visitor'–æ–≤ (run, parseScopesWithVisitors)
4. –ü–µ—á–∞—Ç—å –∫–æ–¥–∞ (prettyPrint, prettyPrintScopes)
5. –î–∞–º–ø AST (dumpAST)
6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è diff (—á–µ—Ä–µ–∑ ColorDiffer)
7. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä–∞ (printEndBanner)

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:** 7 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 3.1.2: ComplexityMetrics - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–¥–∞—á

**–§–∞–π–ª:** `src/ComplexityMetrics.php`

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–º–µ—Ç—Ä–∏–∫–∏)
- –§–∞–±—Ä–∏–∫–∞ (fromNodes)
- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (countLines, calculateNestingDepth)
- –ö–æ–º–ø–∞—Ä–∞—Ç–æ—Ä (compareTo)
- –§–æ—Ä–º–∞—Ç—Ç–µ—Ä (format)
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π (getCognitiveComplexityLevel)

**–°–æ–¥–µ—Ä–∂–∏—Ç:** –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–ª–∞—Å—Å `NestingDepthVisitor` (—Å—Ç—Ä–æ–∫–∏ 216-255) - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º —Ñ–∞–π–ª–æ–º

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 3.1.3: SideEffectSeparator - —Å–º–µ—à–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

**–§–∞–π–ª:** `src/SideEffectSeparator.php` (577 —Å—Ç—Ä–æ–∫)

**–°–æ–¥–µ—Ä–∂–∏—Ç 4 –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–ª–∞—Å—Å–∞:**
- `SeparationResult` (—Å—Ç—Ä–æ–∫–∏ 345-438)
- `EffectGroup` (—Å—Ç—Ä–æ–∫–∏ 443-490)
- `EffectBoundary` (—Å—Ç—Ä–æ–∫–∏ 495-527)
- `PureComputation` (—Å—Ç—Ä–æ–∫–∏ 532-576)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–ª–∞—Å—Å—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 3.2: –ù–∞—Ä—É—à–µ–Ω–∏–µ Open/Closed Principle (OCP)

#### –ü—Ä–æ–±–ª–µ–º–∞ 3.2.1: –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π

**–§–∞–π–ª:** `src/SideEffectClassifier.php` (—Å—Ç—Ä–æ–∫–∏ 20-133)

**–ü—Ä–æ–±–ª–µ–º–∞:** 5 –±–æ–ª—å—à–∏—Ö const –º–∞—Å—Å–∏–≤–æ–≤ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
- `IO_FUNCTIONS` (45 —Ñ—É–Ω–∫—Ü–∏–π)
- `DATABASE_FUNCTIONS` (15 —Ñ—É–Ω–∫—Ü–∏–π)
- `HTTP_FUNCTIONS` (18 —Ñ—É–Ω–∫—Ü–∏–π)
- `NON_DETERMINISTIC_FUNCTIONS` (16 —Ñ—É–Ω–∫—Ü–∏–π)
- `GLOBAL_STATE_FUNCTIONS` (31 —Ñ—É–Ω–∫—Ü–∏–π)

**–í—Å–µ–≥–æ:** 125+ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö PHP —Ñ—É–Ω–∫—Ü–∏–π

**–í–ª–∏—è–Ω–∏–µ:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–ª–∞—Å—Å–∞
- –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ù–∞—Ä—É—à–∞–µ—Ç OCP

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Strategy pattern –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥

```php
interface FunctionClassificationStrategy {
    public function classify(string $functionName): ?SideEffectType;
}

class ArrayBasedStrategy implements FunctionClassificationStrategy { ... }
class ConfigFileStrategy implements FunctionClassificationStrategy { ... }
class CompositeStrategy implements FunctionClassificationStrategy { ... }
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

#### –ü—Ä–æ–±–ª–µ–º–∞ 3.2.2: Sandbox whitelist

**–§–∞–π–ª:** `src/Sandbox.php` (—Å—Ç—Ä–æ–∫–∏ 36-133)

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- `FORBIDDEN_FUNCTIONS` (40+ —Ñ—É–Ω–∫—Ü–∏–π)
- `ALLOWED_PURE_FUNCTIONS` (85+ —Ñ—É–Ω–∫—Ü–∏–π)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 3.3: –ù–∞—Ä—É—à–µ–Ω–∏–µ Interface Segregation Principle (ISP)

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Ö–æ–¥–∫–∞: –ü–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

**–ü–æ–∏—Å–∫:** `grep -r "^interface" src/` - **0 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π**

**–í–ª–∏—è–Ω–∏–µ:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è:
  - Visitors (–∫—Ä–æ–º–µ PhpParser's NodeVisitor)
  - Classifiers (SideEffectClassifier –∏ –¥—Ä.)
  - Calculators (–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)
  - Analyzers
- –°–ª–æ–∂–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –Ω–∞–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (–º–∏–Ω–∏–º—É–º 15):**

```php
// –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
interface EffectClassifierInterface {
    public function classify(Node $node): SideEffectType;
}

// –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã
interface ComplexityCalculatorInterface {
    public function calculate(array $nodes): int;
    public function getComplexityLevel(int $value): string;
}

// Visitors
interface TransformationVisitorInterface extends NodeVisitorAbstract {
    public function getChangeReport(): array;
}

// –•—Ä–∞–Ω–∏–ª–∏—â–µ
interface CacheInterface {
    public function has(string $key): bool;
    public function get(string $key): mixed;
    public function set(string $key, mixed $value): void;
}

interface SymbolTableInterface {
    public function lookup(string $name, string $type): mixed;
    public function define(string $name, mixed $value, string $type): void;
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 3.4: –ù–∞—Ä—É—à–µ–Ω–∏–µ Dependency Inversion Principle (DIP)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É

**–ü—Ä–∏–º–µ—Ä—ã:**

```php
// Parser.php —Å—Ç—Ä–æ–∫–∞ 106 - –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ ColorDiffer
$differ = new ColorDiffer();

// ComplexityMetrics.php —Å—Ç—Ä–æ–∫–∏ 42-43 - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—ã
$cognitiveCalc = new CognitiveComplexityCalculator();
$cyclomaticCalc = new CyclomaticComplexityCalculator();

// AbstractionRecovery.php —Å—Ç—Ä–æ–∫–∏ 45-46
$this->separator = $separator ?? new SideEffectSeparator();
$this->complexityCalculator = $complexityCalculator ?? new CognitiveComplexityCalculator();
```

**–î–æ–ª–∂–Ω–æ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç:**
- `DifferInterface`
- `ComplexityCalculatorInterface`
- `SeparatorInterface`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–Ω–µ–¥—Ä–∏—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

## 4. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 4.1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ–±—Ö–æ–¥–∞ —É–∑–ª–æ–≤

**–§–∞–π–ª—ã:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ visitors

**–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω:**
```php
// –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ ~5 visitors:
foreach ($node->getSubNodeNames() as $name) {
    $subNode = $node->$name;
    if ($subNode instanceof Node) {
        // –æ–±—Ä–∞–±–æ—Ç–∫–∞
    } elseif (is_array($subNode)) {
        foreach ($subNode as $item) {
            if ($item instanceof Node) {
                // –æ–±—Ä–∞–±–æ—Ç–∫–∞
            }
        }
    }
}
```

**–ù–∞–π–¥–µ–Ω–æ –≤:**
- `SideEffectClassifier::classifyChildren()` (—Å—Ç—Ä–æ–∫–∏ 354-380)
- `EffectDependencyGraph::collectNodes()` (—Å—Ç—Ä–æ–∫–∏ 70-116)
- `SideEffectMarkerVisitor::traverseAndCollect()` (—Å—Ç—Ä–æ–∫–∏ 173-202)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ –≤ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –∏–ª–∏ —É—Ç–∏–ª–∏—Ç—É

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 4.2: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤

**–§–∞–π–ª—ã:**
- `src/CognitiveComplexityCalculator.php`
- `src/CyclomaticComplexityCalculator.php`

**–°—Ö–æ–∂–µ—Å—Ç—å –∫–æ–¥–∞:** ~70%

**–û–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω:**
1. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π visitor –∫–ª–∞—Å—Å –¥–ª—è –æ–±—Ö–æ–¥–∞
2. –ú–µ—Ç–æ–¥ `calculate()` —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
3. –ú–µ—Ç–æ–¥ `getComplexityLevel()` —Å –ø–æ—Ä–æ–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π

```php
// –û–±–∞ –∏–º–µ—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
public function calculate(array $nodes): int {
    $visitor = new ComplexityVisitor(); // –†–∞–∑–Ω—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–ª–∞—Å—Å
    $traverser = new NodeTraverser();
    $traverser->addVisitor($visitor);
    // ... –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å

```php
abstract class ComplexityCalculator {
    abstract protected function createVisitor(): NodeVisitorAbstract;
    abstract protected function getThresholds(): array;

    public function calculate(array $nodes): int {
        // –û–±—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    }

    public function getComplexityLevel(int $value): string {
        // –û–±—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É—è getThresholds()
    }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üü¢ –ü—Ä–æ–±–ª–µ–º–∞ 4.3: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ID —É–∑–ª–æ–≤

**–§–∞–π–ª—ã:**
- `BaseVisitor::buildUidByNode()` (—Å—Ç—Ä–æ–∫–∏ 62-64)
- `EffectDependencyGraph::createNodeId()` (—Å—Ç—Ä–æ–∫–∏ 121-130)
- `SideEffectSeparator::getNodeId()` (—Å—Ç—Ä–æ–∫–∏ 300-308)

**–¢—Ä–∏ —Ä–∞–∑–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–¥–Ω–æ–π –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
```php
// BaseVisitor:
crc32($stmt->getStartFilePos() . $stmt->getEndFilePos())

// –î—Ä—É–≥–∏–µ:
sprintf('%s_%d_%d', $node->getType(), $start, $end)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ï–¥–∏–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ –∏–ª–∏ value object

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –°—Ä–µ–¥–Ω–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 4.4: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–∏—Å—Ç—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–§–∞–π–ª—ã:**
- `Sandbox::ALLOWED_PURE_FUNCTIONS` (—Å—Ç—Ä–æ–∫–∏ 74-133) - 85 —Ñ—É–Ω–∫—Ü–∏–π
- `SideEffectClassifier::isPureFunction()` (—Å—Ç—Ä–æ–∫–∏ 409-434) - 35 —Ñ—É–Ω–∫—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–Ω–∞ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è, —Ä–∞–∑–Ω—ã–µ —Å–ø–∏—Å–∫–∏, –Ω–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

## 5. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏ —è—Å–Ω–æ—Å—Ç—å –∫–æ–¥–∞

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 5.1: –û–ø–µ—á–∞—Ç–∫–∞ –≤ –∏–º–µ–Ω–∏ –∫–ª–∞—Å—Å–∞

**–§–∞–π–ª:** `src/Visitor/EvalStandartFunction.php`

**–ü—Ä–æ–±–ª–µ–º–∞:** "Standart" –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "Standard"
- –ò–º—è –∫–ª–∞—Å—Å–∞: `EvalStandartFunction`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `Parser.php` —Å—Ç—Ä–æ–∫–∞ 93

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (–ª–µ–≥–∫–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å, –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ)

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 5.2: –ù–µ—è—Å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è

**–§–∞–π–ª:** `src/ScopeStore.php`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–ª–∞—Å—Å —Ö—Ä–∞–Ω–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –∫–ª–∞—Å—Å—ã - –Ω–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç —Ç–æ–ª—å–∫–æ "scope"

**–õ—É—á—à–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:** `SymbolTable` –∏–ª–∏ `ScopeManager`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 5.3: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤

**–§–∞–π–ª:** `src/ScopeStore.php`

**–ü–∞—Ç—Ç–µ—Ä–Ω:** Getter/Setter –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è

```php
// –¢–µ–∫—É—â–µ–µ (–º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω–æ–µ):
setVarToScope()      vs.  getVarFromScope()
setConstToGlobal()   vs.  getConstFromGlobal()

// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
setVar()             vs.  getVar()
setGlobalConst()     vs.  getGlobalConst()
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –°—Ä–µ–¥–Ω–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 5.4: –†—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–¥–µ

**–§–∞–π–ª—ã:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ

**–ü—Ä–∏–º–µ—Ä—ã:**
- `README.md` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ —Å–º–µ—à–∏–≤–∞—é—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π

```php
// Parser.php —Å—Ç—Ä–æ–∫–∞ 113:
// —Å–≤—è–∑–∏ —É–∑–ª–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —Ä–∞–∑
```

**–í–ª–∏—è–Ω–∏–µ:** –°–Ω–∏–∂–∞–µ—Ç –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–µ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –õ–∏–±–æ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –∞–Ω–≥–ª–∏–π—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- –õ–∏–±–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å—ë –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π (–µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ–µ–∫—Ç)

---

## 6. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å—é

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 6.1: Parser - –Ω–µ—Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –¥–∏–∑–∞–π–Ω

**–§–∞–π–ª:** `src/Parser.php`

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ file I/O (`file_get_contents`, `file_put_contents`)
- –ü—Ä—è–º—ã–µ `echo` (—Å—Ç—Ä–æ–∫–∏ 137, 180, 257, 276)
- –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ visitors
- –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ (`buildScopes()`)
- –ù–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
- Visitor pipeline –±–µ–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –õ–æ–≥–∏–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –∑–∞—Ö–≤–∞—Ç–∞ stdout

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–Ω–µ–¥—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:
```php
public function __construct(
    private readonly FileSystemInterface $fs,
    private readonly OutputInterface $output,
    private readonly VisitorFactory $visitorFactory,
) {}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 6.2: Sandbox –∏—Å–ø–æ–ª—å–∑—É–µ—Ç eval()

**–§–∞–π–ª:** `src/Sandbox.php` (—Å—Ç—Ä–æ–∫–∞ 262)

```php
// –°—Ç—Ä–æ–∫–∞ 262 - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç eval –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞
$result = eval('?>' . $code);
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–¥–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π PHP `eval()` –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ "sandbox"
- –†–∏—Å–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–∂–µ —Å whitelist

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 6.3: InteractiveCLI —Å–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

**–§–∞–π–ª:** `src/InteractiveCLI.php`

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ß–∏—Ç–∞–µ—Ç –∏–∑ `STDIN` –Ω–∞–ø—Ä—è–º—É—é (—Å—Ç—Ä–æ–∫–∞ 372)
- –ü–∏—à–µ—Ç –≤ `STDOUT` —á–µ—Ä–µ–∑ `echo` (—Å—Ç—Ä–æ–∫–∞ 364)
- –ù–µ—Ç –∏–Ω—ä–µ–∫—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ—Ç–æ–∫ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–Ω–µ–¥—Ä–∏—Ç—å stream –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 6.4: –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ ScopeStore

**–§–∞–π–ª:** `src/ScopeStore.php`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—É–±–ª–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω—è–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

```php
public array $global = [];
public array $scopes = [];
public ?string $currentScope = null;
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

## 7. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 7.1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞

**–¢–µ–∫—É—â–µ–µ:** `CognitiveComplexityCalculator` –∏ `CyclomaticComplexityCalculator` –¥—É–±–ª–∏—Ä—É—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```php
abstract class ComplexityCalculator {
    abstract protected function createVisitor(): NodeVisitorAbstract;
    abstract protected function getThresholds(): array;

    public function calculate(array $nodes): int {
        // –û–±—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    }

    public function getComplexityLevel(int $value): string {
        // –û–±—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ getThresholds()
    }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 7.2: Primitive Obsession - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Value Objects

**–ü—Ä–∏–º–µ—Ä—ã:**
- ID —É–∑–ª–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏
- –ó–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–∞–∫ —Å—ã—Ä—ã–µ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞
- –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–æ:**

```php
readonly class NodeId {
    public function __construct(
        public string $type,
        public int $start,
        public int $end
    ) {}

    public function toString(): string {
        return sprintf('%s_%d_%d', $this->type, $this->start, $this->end);
    }
}

readonly class ComplexityScore {
    public function __construct(
        public int $value,
        public ComplexityLevel $level
    ) {}
}

readonly class FilePath {
    public function __construct(
        public string $path
    ) {}

    public function exists(): bool { ... }
    public function read(): string { ... }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –°—Ä–µ–¥–Ω–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 7.3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Strategy Pattern –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–¢–µ–∫—É—â–µ–µ:** –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã –≤ `SideEffectClassifier`

**–î–æ–ª–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```php
interface FunctionClassificationStrategy {
    public function classify(string $functionName): ?SideEffectType;
}

class ArrayBasedStrategy implements FunctionClassificationStrategy {
    public function __construct(private array $mapping) {}
}

class ConfigFileStrategy implements FunctionClassificationStrategy {
    public function __construct(private string $configPath) {}
}

class CompositeStrategy implements FunctionClassificationStrategy {
    public function __construct(private array $strategies) {}

    public function classify(string $functionName): ?SideEffectType {
        foreach ($this->strategies as $strategy) {
            if ($result = $strategy->classify($functionName)) {
                return $result;
            }
        }
        return null;
    }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 7.4: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Factory Pattern –¥–ª—è Visitors

**–¢–µ–∫—É—â–µ–µ:** Parser –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–µ—Ç visitors

**–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ñ–∞–±—Ä–∏–∫–∞:**
```php
interface VisitorFactoryInterface {
    public function createVisitors(): array;
}

class UnfoldPhaseVisitorFactory implements VisitorFactoryInterface {
    public function __construct(
        private readonly ScopeStore $scopeStore,
        private readonly string $cacheDir
    ) {}

    public function createVisitors(): array {
        return [
            new BinaryAndIssetVisitor(),
            new RemoveVisitor(),
            new ConcatAssertVisitor(),
            new EvalStandardFunction(),
            new VarToScalarVisitor($this->scopeStore),
            new FunctionScopeVisitor($this->scopeStore, $this->cacheDir),
            new CallFunctionVisitor($this->scopeStore),
            new ConstClassVisitor($this->scopeStore),
            new TernarReturnVisitor(),
        ];
    }
}

class FoldPhaseVisitorFactory implements VisitorFactoryInterface { ... }
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

## 8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### üî¥ –ü—Ä–æ–±–ª–µ–º–∞ 8.1: –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ–±—Ö–æ–¥—ã AST

**–§–∞–π–ª:** `src/Parser.php`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ `parseScopes()` (—Å—Ç—Ä–æ–∫–∏ 104-149):
- –û–±—Ö–æ–¥–∏—Ç AST –¥–ª—è `NodeConnectingVisitor` (—Å—Ç—Ä–æ–∫–∞ 115)
- –û–±—Ö–æ–¥–∏—Ç AST –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ visitor (—Å—Ç—Ä–æ–∫–∞ 126)
- Pretty print –¥–æ –ò –ø–æ—Å–ª–µ (—Å—Ç—Ä–æ–∫–∏ 124, 128)
- **2-3 –ø–æ–ª–Ω—ã—Ö –æ–±—Ö–æ–¥–∞ AST –Ω–∞ –∫–∞–∂–¥—ã–π visitor –Ω–∞ –∫–∞–∂–¥—ã–π scope**

**–î–ª—è 10 visitors:** 20-30 –ø–æ–ª–Ω—ã—Ö –æ–±—Ö–æ–¥–æ–≤ AST

**–í–ª–∏—è–Ω–∏–µ:** –ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å O(N¬≤) –≥–¥–µ N - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ visitors

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ visitors –≤ –æ–¥–∏–Ω –æ–±—Ö–æ–¥ –≥–¥–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 8.2: File I/O –≤ –≥–æ—Ä—è—á–µ–º —Ü–∏–∫–ª–µ

**–§–∞–π–ª:** `src/Parser.php` (—Å—Ç—Ä–æ–∫–∞ 146)

```php
// –°—Ç—Ä–æ–∫–∞ 146 - –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞ –¥–∏—Å–∫ –ø–æ—Å–ª–µ –ö–ê–ñ–î–û–ì–û visitor
if ($updateCache) {
    $this->updateCache();  // –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫
}
```

**–í–ª–∏—è–Ω–∏–µ:** –î–ª—è N visitors √ó M scopes –≤—ã–ø–æ–ª–Ω—è–µ—Ç N√óM –∑–∞–ø–∏—Å–µ–π —Ñ–∞–π–ª–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ë–∞—Ç—á–µ–≤–∞—è –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤, —Ç–æ–ª—å–∫–æ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö —Ñ–∞–∑

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üü¢ –ü—Ä–æ–±–ª–µ–º–∞ 8.3: –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `src/EffectDependencyGraph.php` (—Å—Ç—Ä–æ–∫–∏ 161-185)

**–ü—Ä–æ–±–ª–µ–º–∞:** `buildDependencies()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- O(N¬≤) —Å–ª–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è N —É–∑–ª–æ–≤
- –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç `$varDefinitions` –∫–∞–∂–¥—ã–π —Ä–∞–∑

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –°—Ä–µ–¥–Ω–∏–π

---

### üü¢ –ü—Ä–æ–±–ª–µ–º–∞ 8.4: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ AST

**–§–∞–π–ª:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ visitors

**–ü—Ä–∏–º–µ—Ä** (`CallFunctionVisitor.php` —Å—Ç—Ä–æ–∫–∞ 30):
```php
$expr = $traverser->traverse([clone $expr]);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ì–ª—É–±–æ–∫–æ–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–¥–¥–µ—Ä–µ–≤—å–µ–≤ AST –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –ø–∞–º—è—Ç–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –°—Ä–µ–¥–Ω–∏–π

---

### üü¢ –ü—Ä–æ–±–ª–µ–º–∞ 8.5: –ù–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–§–∞–π–ª:** `src/Parser.php`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ–≥–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å—é –∫–æ–¥–æ–≤—É—é –±–∞–∑—É
- –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ AST –¥–ª—è —Ñ–∞–π–ª–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

---

## 9. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üü° –ü—Ä–æ–±–ª–µ–º–∞ 9.1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ù–∞–±–ª—é–¥–µ–Ω–∏–µ:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ü—Ä–æ–±–ª–µ–º—ã:**
- `SandboxError` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ú–Ω–æ–≥–∏–µ –º–µ—Ç–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `null` –ø—Ä–∏ –æ—à–∏–±–∫–µ (–Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ)
- –ù–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –¢–∏—Ö–∏–µ –æ—à–∏–±–∫–∏ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

**–ü—Ä–∏–º–µ—Ä** (`Parser.php` —Å—Ç—Ä–æ–∫–∏ 254-260):
```php
} catch (Error $e) {
    if ($e->hasColumnInfo()) {
        echo $e->getMessageWithColumnInfo();
    } else {
        echo $e->getMessage();
    }
}
// –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞!
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é –∏—Å–∫–ª—é—á–µ–Ω–∏–π:
```php
class RecombinatorException extends Exception {}
class ParseException extends RecombinatorException {}
class TransformationException extends RecombinatorException {}
class SandboxException extends RecombinatorException {}
class ValidationException extends RecombinatorException {}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –í—ã—Å–æ–∫–∏–π

---

### üü¢ –ü—Ä–æ–±–ª–µ–º–∞ 9.2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- –ü–æ—Ä–æ–≥–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (—Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –∫–æ–¥—É)
- –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º (`index.php`, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–µ—à–∞)
- –§–ª–∞–≥–∏ —Ñ—É–Ω–∫—Ü–∏–π (`$superOptimize`, `$isDry`)

**–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å:** –û–±—ä–µ–∫—Ç/—Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```php
class RecombinatorConfig {
    public function __construct(
        public readonly int $maxCognitiveComplexity = 10,
        public readonly int $maxCyclomaticComplexity = 10,
        public readonly string $entryPoint = 'index.php',
        public readonly string $cacheDir = '.cache',
        public readonly bool $superOptimize = false,
        public readonly bool $dryRun = false,
    ) {}

    public static function fromFile(string $path): self { ... }
    public static function fromArray(array $config): self { ... }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –°—Ä–µ–¥–Ω–∏–π

---

### üü¢ –ü—Ä–æ–±–ª–µ–º–∞ 9.3: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –í—ã–≤–æ–¥ —Å–º–µ—à–∞–Ω —Å `echo` –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏
- –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ—Ç —É—Ä–æ–≤–Ω–µ–π –æ—Ç–ª–∞–¥–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PSR-3 Logger –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```php
interface LoggerInterface {
    public function debug(string $message, array $context = []): void;
    public function info(string $message, array $context = []): void;
    public function warning(string $message, array $context = []): void;
    public function error(string $message, array $context = []): void;
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü¢ –ù–∏–∑–∫–∏–π (—É–ª—É—á—à–µ–Ω–∏–µ)

---

## 10. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å)

1. **–ò–∑–≤–ª–µ—á—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** –¥–ª—è –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (classifiers, calculators, visitors)
2. **–í–Ω–µ–¥—Ä–∏—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Parser** - —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 7 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
4. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø–µ—á–∞—Ç–∫—É:** `EvalStandartFunction` ‚Üí `EvalStandardFunction`
5. **–ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞—Ç—å ScopeStore** - —É–±—Ä–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
6. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ö–æ–¥—ã AST** - —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Å N√óM –¥–æ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

### üü° –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

7. **–°–æ–∑–¥–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π ComplexityCalculator** –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–≤
8. **–í–Ω–µ–¥—Ä–∏—Ç—å Strategy pattern** –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π
9. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É namespace** (—Å–º. —Ä–∞–∑–¥–µ–ª 1.3)
10. **–†–∞–∑–¥–µ–ª–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–ª–∞—Å—Å—ã** –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (4 –∫–ª–∞—Å—Å–∞ –≤ SideEffectSeparator.php, NestingDepthVisitor)
11. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π –∏—Å–∫–ª—é—á–µ–Ω–∏–π
12. **–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π** –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –∞–Ω–≥–ª–∏–π—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### üü¢ –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

13. **–°–æ–∑–¥–∞—Ç—å Value Objects** –¥–ª—è NodeId, ComplexityScore –∏ —Ç.–¥.
14. **–í–Ω–µ–¥—Ä–∏—Ç—å Factory pattern** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è visitors
15. **–î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
16. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** —Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
17. **–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é** –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è AST

### ‚ö™ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

18. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–ª—é—á–∏** –Ω–∞ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
19. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É**
20. **–í–Ω–µ–¥—Ä–∏—Ç—å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**
21. **–†–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** (–Ω–∞–π–¥–µ–Ω–æ ~20 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è 49 –∫–ª–∞—Å—Å–æ–≤)

---

## 11. –ú–µ—Ç—Ä–∏–∫–∏

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|-----------|-----------|
| –í—Å–µ–≥–æ PHP —Ñ–∞–π–ª–æ–≤ | 49 |
| –ö–ª–∞—Å—Å–æ–≤ –±–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ | 49 (100%) |
| –ù–∞—Ä—É—à–µ–Ω–∏–π SRP | 8 –æ—Å–Ω–æ–≤–Ω—ã—Ö |
| –ù–∞—Ä—É—à–µ–Ω–∏–π OCP | 4 –æ—Å–Ω–æ–≤–Ω—ã—Ö |
| –ù–∞—Ä—É—à–µ–Ω–∏–π DIP | 15+ |
| –°–ª—É—á–∞–µ–≤ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ | 6 –æ—Å–Ω–æ–≤–Ω—ã—Ö |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (—Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∫–ª–∞—Å—Å) | 577 (SideEffectSeparator) |
| –í—ã—è–≤–ª–µ–Ω–æ God objects | 2 (Parser, ComplexityMetrics) |
| –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π | 15+ |
| –£–∑–∫–∏—Ö –º–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ | 6 |

---

## 12. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

‚úÖ **–ß–µ—Ç–∫–∞—è –º–æ–¥–µ–ª—å –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏:**
- –•–æ—Ä–æ—à–æ –ø—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (SideEffectType enum)
- –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –∏ —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è)
- –ü–æ–Ω—è—Ç–Ω–∞—è —Ç—Ä–µ—Ö—Ñ–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (unfold ‚Üí fold ‚Üí interactive)

‚úÖ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π PHP:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ readonly —Å–≤–æ–π—Å—Ç–≤ (PHP 8.1+)
- –¢–∏–ø–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ enum (PHP 8.1+)

‚úÖ **–ü–∞—Ç—Ç–µ—Ä–Ω Visitor:**
- –ì—Ä–∞–º–æ—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Visitor –¥–ª—è –æ–±—Ö–æ–¥–∞ AST
- –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö visitors

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–ª–∞–±–æ—Å—Ç–∏

‚ùå **–ù–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:**
- –ù–∞—Ä—É—à–∞–µ—Ç DIP –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

‚ùå **–¢–µ—Å–Ω–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å:**
- –ù–∞—Ä—É—à–∞–µ—Ç OCP –∏ DIP
- –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- God objects (Parser)

‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π:**
- –ù–µ—Ç Strategy/Factory –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≥–¥–µ –Ω—É–∂–Ω–æ
- Primitive obsession (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ –≤–º–µ—Å—Ç–æ value objects)

‚ùå **–ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å—é:**
- –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π I/O
- –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö

### –û—Ü–µ–Ω–∫–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ª–≥–∞: –í—ã—Å–æ–∫–∏–π (7/10)

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞
**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –ö—Ä—É–ø–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è production

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

**–§–∞–∑–∞ 1: –û—Å–Ω–æ–≤–∞ (2-3 –Ω–µ–¥–µ–ª–∏)**
1. –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. –í–Ω–µ–¥—Ä–∏—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Parser –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø–µ—á–∞—Ç–∫–∏ –∏ –æ—á–µ–≤–∏–¥–Ω—ã–µ –±–∞–≥–∏

**–§–∞–∑–∞ 2: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (3-4 –Ω–µ–¥–µ–ª–∏)**
5. –†–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É namespace
6. –í–Ω–µ–¥—Ä–∏—Ç—å Strategy –∏ Factory –ø–∞—Ç—Ç–µ—Ä–Ω—ã
7. –°–æ–∑–¥–∞—Ç—å Value Objects
8. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

**–§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2-3 –Ω–µ–¥–µ–ª–∏)**
9. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ö–æ–¥—ã AST
10. –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
11. –£–ª—É—á—à–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
12. –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

**–û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** 7-10 –Ω–µ–¥–µ–ª—å

---

**–ê–≤—Ç–æ—Ä –æ—Ç—á–µ—Ç–∞:** Claude
**–î–∞—Ç–∞:** 2025-11-22
**–í–µ—Ä—Å–∏—è:** 1.0
