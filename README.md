первая глобальная задача - генерить плоский код, эквивалентный оригинальному.

Для этого нужно разворачивать функции и классы, правильно подставляя
полученую развертку в места использования.
